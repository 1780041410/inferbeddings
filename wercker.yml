# Wercker configuration file

box: python:3.6

no-response-timeout: 60
command-timeout: 60

build:
  steps:
    - script:
      name: echo system information
      code: |
        uname -a
        echo "python3 version $(python3 --version) running"
        echo "pip3 version $(pip3 --version) running"
        ls

test-light:
  steps:
    - pip-install

    - script:
        name: setup
        code: |
          sudo apt-get update
          DEBIAN_FRONTEND=noninteractive sudo apt-get -y install apt-utils libtcmalloc-minimal4

    - script:
        name: install
        code: |
          python3 setup.py install

    - script:
        name: Run unit tests
        code: |
          LD_PRELOAD=`ls /usr/lib/libtcmalloc_minimal.so.* | head -n 1` python3 -m pytest tests -v -m "(not slow) and (not veryslow)"

test-slow:
  steps:
    - pip-install

    - script:
        name: setup
        code: |
          sudo apt-get update
          DEBIAN_FRONTEND=noninteractive sudo apt-get -y install apt-utils libtcmalloc-minimal4

    - script:
        name: install
        code: |
          python3 setup.py install

    - script:
        name: Run slow unit tests
        code: |
          LD_PRELOAD=`ls /usr/lib/libtcmalloc_minimal.so.* | head -n 1` python3 -m pytest tests -v -m "(slow) and (not veryslow)"

test-veryslow:
  steps:
    - pip-install

    - script:
        name: setup
        code: |
          sudo apt-get update
          DEBIAN_FRONTEND=noninteractive sudo apt-get -y install apt-utils libtcmalloc-minimal4

    - script:
        name: install
        code: |
          python3 setup.py install

    - script:
        name: Run very slow unit tests
        code: |
          LD_PRELOAD=`ls /usr/lib/libtcmalloc_minimal.so.* | head -n 1` python3 -m pytest tests -v -m "(not slow) and (veryslow)"
